{% load staticfiles %}
<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
  </head>
  <body>
    <h1>Smart Storm Drain</h1>
    <h2>Select a Device</h2>
    {% block content %}
    <form method="POST" class="post-form">{% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="save btn btn-default">Submit</button>
    </form>
    {% endblock %}
    <canvas id="myChart"></canvas>
    <h2>
      <a href="{% url 'ui' %}">Final User Interface Vision</a>
    </h2>
  </body>
</html>

<script type="text/javascript">
  // var ctx = document.getElementById('myChart');
  // var myLineChart = new Chart(ctx, {
  //     type: 'line',
  //     data: {
  //       datasets: [{
  //         backgroundColor: 'rgba(0,102,255,0.5)',
  //         borderColor: 'rgba(0,102,255,0.5)',
  //         data: [
  //           {% for transmission in transmissions %}
  //           {
  //             x: new Date("{{ transmission.timestamp.isoformat }}"),
  //             y: {{ transmission.depth }}
  //           },
  //           {% endfor %}
  //         ]
  //       }]
  //     },
  //     options: {
  //       legend: {
  //         display: false
  //       },
  //       title: {
  //         display: true,
  //         text: 'Water Depth of {{ device.name }}',
  //         fontSize: 30
  //       },
  //       scales: {
  //         xAxes: [{
  //           type: 'time',
  //           scaleLabel: {
  //             display: true,
  //             labelString: 'Datetime',
  //             fontSize: 20
  //           }
  //         }],
  //         yAxes: [{
  //           scaleLabel: {
  //             display: true,
  //             labelString: 'Depth (ft)',
  //             fontSize: 20
  //           }
  //         }],
  //       }
  //     }
  // });

  // Assigns proper point colors based on the flowrate
  var pointBackgroundColors = [
    {% for transmission in transmissions %}
      {% if transmission.flowrate == 1 %}
        'rgba(0,204,0,0.5)',
      {% elif transmission.flowrate == 2 %}
        'rgba(255,204,0,0.5)',
      {% elif transmission.flowrate == 3 %}
        'rgba(255,0,0,0.5)',
      {% else %}
        'rgba(128,128,128,0.5)',
      {% endif %}
    {% endfor %}
  ];
  var pointBorderColors = [
    {% for transmission in transmissions %}
      {% if transmission.flowrate == 1 %}
        'rgba(0,204,0,1)',
      {% elif transmission.flowrate == 2 %}
        'rgba(255,204,0,1)',
      {% elif transmission.flowrate == 3 %}
        'rgba(255,0,0,1)',
      {% else %}
        'rgba(128,128,128,1)',
      {% endif %}
    {% endfor %}
  ];

  var ctx = document.getElementById('myChart');
  var myBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        datasets: [{
          backgroundColor: pointBackgroundColors,
          borderColor: pointBorderColors,
          borderWidth: 1,
          data: [
            {% for transmission in transmissions %}
            {
              x: new Date("{{ transmission.timestamp.isoformat }}"),
              y: {{ transmission.flowrate }}
            },
            {% endfor %}
          ],
        }]
      },
      options: {
        legend: {
          display: false
        },
        title: {
          display: true,
          text: 'Flow Rate of {{ device.name }}',
          fontSize: 30
        },
        scales: {
          xAxes: [{
            // offset: true,
            type: 'time',
            scaleLabel: {
              display: true,
              labelString: 'Datetime',
              fontSize: 20
            }
          }],
          yAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'Flow Rate',
              fontSize: 20
            },
            ticks: {
              beginAtZero: true,
              suggestedMax: 3,
              callback: function(label) {
                switch(label) {
                  case 0:
                    return 'None';
                  case 1:
                    return 'Low';
                  case 2:
                    return 'Medium';
                  case 3:
                    return 'High';
                }
              }
            }
          }],
        },
      }
  });
</script>
